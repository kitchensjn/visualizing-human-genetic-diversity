<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, interactive-widget=resizes-content">
        <title>Euler Diagrams and Visualizing Human Genetic Diversity</title>
        <script defer src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <style>
            html, body, form {
                margin: 0;
                height: 100dvh;
                overflow: hidden;
                touch-action: none;
            }

            .figure {
                background-color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-direction: column;
                height: calc(100% - 150px);
                padding: 50px 15%;
            }

            .full {
                width: 100%;
                height: 100%; 
            }

            #welcome {
                background-color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-direction: column;
                padding: 50px 15%;
            }

            #welcome-text {
                max-height: 100%;
                overflow: auto;
            }

            .carousel-caption {
                background-color: rgba(255,255,255,1);
                padding: 10px 20px;
                outline: 1px lightgrey solid;
                bottom: 2.5rem;
                max-height: calc(100dvh - 75px);
                overflow: auto
            }

            .carousel-control-hide-caption{
                background: 0 0;
                border: 0;
                opacity: .5;
                transition: all .15s ease;
            }

            .carousel-control-prev:hover, .carousel-control-next:hover {
                opacity: 0.5;
            }

            .caption-control-text {
                margin: 0;
                color: black;
            }

            .hide-caption-icon {
                transform: rotate(-90deg);
            }

            @media (hover: hover) {
                .carousel-control-prev:hover, .carousel-control-next:hover {
                    opacity: 1;
                }
                .carousel-control-hide-caption:hover, .caption-control-text {
                    opacity: 1;
                }
            }


            @media(max-width:767px) {
                .desc {
                    text-align: left;
                }
            }

            .input-dashboard {
                width: 100%;
                display: flex;
                flex-wrap: wrap;
                justify-content: space-around;
                text-align: center;
                padding-bottom: 50px;
            }

            #overlay {
                position: absolute;
                top: 0px;
                left: 0px;
                height: 100%;
                width: 100%;
                background-color: rgba(255,255,255,0.75);
                z-index: 2;
            }

            #box {
                width: 100%;
                height: 100%;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                color: #053e4e;
            }

            .loader {
                border: 20px solid #053e4e;
                border-radius: 50%;
                border-top: 20px solid #1eebb1;
                width: 100px;
                height: 100px;
                animation: spinner 4s linear infinite;
            }

            @keyframes spinner {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

            #complete {
                width: 100%;
                height: 100%;
                padding: 50px 15%;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }

            #codename_display {
                max-width: 100%;
                word-wrap: break-word;
                font-size: 30px;
            }

            .center {
                text-align: center;
            }

            .region_input {
                display: flex;
                flex-direction: column;
                padding: 0px 10px;
            }

            .answer {
                color: green;
                opacity: 0;
            }

            .region3 {
                height: 29.736px;
                margin: 0px;
            }



            .circle, .line{
                fill: none;
                stroke: #231f20;
                stroke-miterlimit: 10;
            }
            .circle {
                stroke-width: 2px;
            }
            .line {
                stroke-width: 1px;
            }
            .text, .label {
                font-size: 12px;
                fill: #231f20;
                font-family: MyriadPro-Regular, Myriad Pro;
            }
        </style>
    </head>
    <body>
        <div id="box"></div>
        <script type="module">
            const pyodide = await loadPyodide();
            await pyodide.loadPackage(["shapely"]);
            const shapely = await pyodide.pyimport("shapely");
            
            pyodide.runPython(`
                import js
                import math
                from shapely.geometry import Polygon
                from shapely.ops import unary_union
                from itertools import combinations


                def createPointsListForEllipse(x, y, a, b, angle):
                    y = -y
                    angle = -angle
                    theta = [x * 2 * math.pi / 100 for x in range(100)]
                    coords = []
                    for i in theta:
                        coords.append([a * math.cos(i) * math.cos(angle) - b * math.sin(i) * math.sin(angle) + x, a * math.cos(i) * math.sin(angle) + b * math.sin(i) * math.cos(angle) + y]) 
                    return coords

                def calculate_intersection_areas(data):
                    ellipses = []
                    for ellipse in data:
                        poly = Polygon(createPointsListForEllipse(ellipse.h, ellipse.k, ellipse.a, ellipse.b, ellipse.phi))
                        ellipses.append(poly)
                    areas = []
                    for a in range(len(ellipses)):
                        a_sum = 0
                        for combo in combinations(range(len(ellipses)), a+1):
                            poly_combo = ellipses[combo[0]]
                            for i in range(len(combo)-1):
                                poly_combo = poly_combo.intersection(ellipses[combo[i+1]])
                            not_combo = [e for i,e in enumerate(ellipses) if i not in combo]
                            poly_not = unary_union(not_combo)
                            diff = poly_combo.difference(poly_not)
                            a_sum += diff.area
                        areas.append(a_sum)
                    if len(areas) > 0:
                        total = sum(areas)
                        areas = [round((a/total)*100) for a in areas]
                    else:
                        areas = ["~"]
                    return areas

                js.intersection_stats = calculate_intersection_areas
            `);

            document.getElementById("box").remove();
        </script>
        <script>
            var loader = d3.select("#box");
            loader.append("div").attr("class", "loader");
            loader.append("h1").text("LOADING...");

            function create_interactive_euler_diagram(id, where, data, dim, downscale, bottom_y, top_y, overlap_output) {
                var shift_h = dim/2;
                var shift_v = dim/2;

                var svg_container = d3.select("#"+where)
                    .append("svg")
                    .attr("id", id)
                    .attr("width", "100%")
                    .attr("height", "100%")
                    .attr("viewBox", "0 0 " + dim + " " + dim);

                svg_container
                    .append("line")
                    .attr("x1", 0)
                    .attr("x2", 0)
                    .attr("y1", bottom_y/downscale)
                    .attr("y2", top_y/downscale)
                    .attr("transform", "translate(" + shift_h + ", " + shift_v + ")")
                    .attr("stroke", "lightgrey")
                    .attr("stroke-width", 2);

                svg_container
                    .append("circle")
                    .attr("cx", 0)
                    .attr("cy", bottom_y/downscale)
                    .attr("r", 5)
                    .attr("transform", "translate(" + shift_h + ", " + shift_v + ")")
                    .attr("fill", "lightgrey");
                
                svg_container
                    .append("circle")
                    .attr("cx", 0)
                    .attr("cy", top_y/downscale)
                    .attr("r", 5)
                    .attr("transform", "translate(" + shift_h + ", " + shift_v + ")")
                    .attr("fill", "lightgrey");

                svg_container
                    .selectAll("ellipses")
                    .data(data)
                    .enter()
                    .append("path")
                    .attr("stroke", function(d) { return d.color; })
                    .attr("stroke-width", 15)
                    .attr("stroke-dasharray", function(d) { return d.stroke_dasharray; })
                    .attr("fill", "none")
                    .attr("d", function(d) {
                        return ["M", (d.h/downscale+d.a/downscale+shift_h), (d.k/downscale+shift_v), "A", d.a/downscale, d.b/downscale, 0, 1, 1, (d.h/downscale+d.a/downscale+shift_h), (d.k/downscale+shift_v-0.001)].join(' ')
                    })
                    .attr("transform", function(d) {
                        return "rotate(" + d.phi*(180/Math.PI) + " " + (d.h/downscale+shift_h) + " " + (d.k/downscale+shift_h) + ")"; 
                    });

                svg_container
                    .selectAll("path")
                        .on("mouseover", function(event, d) {
                            d3.select(this)
                                .style("cursor", "grab")
                                .style("opacity", 1);
                        })
                        .on("mouseout", function(d) {
                            d3.select("#"+id)
                                .selectAll("path")
                                    .style("opacity", 1);
                        })
                        .call(d3.drag()
                            .on("start", dragstart)
                            .on("drag", dragging)
                            .on("end", dragend));

                function dragstart(event, d) {
                    d3.select("body").style("cursor", "grabbing");
                    d3.select("#"+id)
                        .selectAll("path")
                            .style("pointer-events", "none")
                            .style("opacity", 0.25);
                    d3.select(this)
                        .style("opacity", 1);
                }

                function dragging(event, d) {
                    d3.select("#"+id)
                        .selectAll("path")
                            .style("pointer-events", "none")
                            .style("opacity", 0.25);
                    d3.select(this)
                        .style("opacity", 1);
                    d.k = d.k + event.dy*downscale;
                    if (d.k < top_y) {
                        d.k = top_y;
                    } else if (d.k > bottom_y) {
                        d.k = bottom_y;
                    }
                    d3.select(this)
                        .attr("d", function(d) {
                            return ["M", (d.h/downscale+d.a/downscale+shift_h), (d.k/downscale+shift_v), "A", d.a/downscale, d.b/downscale, 0, 1, 1, (d.h/downscale+d.a/downscale+shift_h), (d.k/downscale+shift_v-0.001)].join(' ')
                        })
                        .attr("transform", function(d) {
                            return "rotate(" + d.phi*(180/Math.PI) + " " + (d.h/downscale+shift_h) + " " + (d.k/downscale+shift_v) + ")";
                        });
                }

                function dragend(event, d) {
                    d3.select("body").style("cursor", "initial");
                    d3.select("#"+id)
                        .selectAll("path")
                            .style("pointer-events", "initial")
                            .style("opacity", 1);
                    var intersection = intersection_stats(data);
                    d3.selectAll("input")
                        .filter(function() {
                            return d3.select(this).attr("name") == overlap_output;
                        })
                        .attr("value", intersection[intersection.length-1]);
                    d3.select("#"+where).select(".answer").text("Your diagram shows " + intersection[intersection.length-1] +"% overlap.");
                }
            }
        </script>
        <form name="submit-to-google-sheet" id="form">
            <div id="carousel" class="carousel carousel-dark slide full" data-bs-touch="false" data-bs-ride="false" data-bs-wrap="false">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#carousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#carousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
                    <button type="button" data-bs-target="#carousel" data-bs-slide-to="3" aria-label="Slide 4"></button>
                    <button type="button" data-bs-target="#carousel" data-bs-slide-to="4" aria-label="Slide 5"></button>
                    <button type="button" data-bs-target="#carousel" data-bs-slide-to="5" aria-label="Slide 6"></button>
                    <button type="button" data-bs-target="#carousel" data-bs-slide-to="6" aria-label="Slide 7"></button>
                    <button type="button" data-bs-target="#carousel" data-bs-slide-to="7" aria-label="Slide 8"></button>
                    <button type="button" data-bs-target="#carousel" data-bs-slide-to="8" aria-label="Slide 9"></button>
                    <button type="button" data-bs-target="#carousel" data-bs-slide-to="9" aria-label="Slide 10"></button>
                </div>
                <div class="carousel-inner full">
                    <div id="slide0" class="carousel-item active full">
                        <div id="welcome" class="full">
                            <div id="welcome-text">
                                <p class="desc">Welcome! This activity was created to measure the effectiveness of Euler diagrams and their application to human genetic datasets. Your responses to questions in this activity will be anonymously recorded; once you've submitted your answer to each section, you will not be able to change it. Your performance in this activity will not be graded on correctness. Your participation helps in our study. If you have any questions, please reach out to James Kitchens or Professor Graham Coop.<br><br>This activity is split into two parts. The first part will serve as an introduction to Euler diagrams and give chances to practice constructing these figures. In the second part, you will apply these Euler diagrams to a dataset of human genetic diversity.</p>
                            </div>
                        </div>
                    </div>
                    <div id="slide1" class="carousel-item full">
                        <div class="figure">
                            <svg viewBox="0 0 117.64 268.74">
                                <circle class="circle" cx="30.15" cy="223.98" r="15.61"/>
                                <circle class="circle" cx="67.7" cy="223.98" r="43.76"/>
                                <circle class="circle" cx="43.1" cy="55.64" r="28.46"/>
                                <circle class="circle" cx="82.9" cy="55.64" r="28.46"/>
                                <text class="text" transform="translate(27.47 10.04)">
                                    Venn Diagram
                                </text>
                                <text class="text" transform="translate(8.36 123.83)">
                                    and its corresponding
                                </text>
                                <text class="text" transform="translate(28.3 162.17)">
                                    Euler diagram
                                </text>
                                <text class="label" transform="translate(29.09 58.36)">20</text>
                                <text class="label" transform="translate(79.04 58.36)">500</text>
                                <text class="label" transform="translate(56.57 58.36)">50</text>
                                <text class="label" transform="translate(0 204.73)">20</text>
                                <text class="label" transform="translate(63 227.56)">500</text>
                                <text class="label" transform="translate(28.06 227.55)">50</text>
                                <line class="line" x1="12" y1="207" x2="17.26" y2="212.55"/>
                            </svg>
                        </div>
                        <div class="carousel-caption">
                            <button id="slide1_hide" class="carousel-control-hide-caption" type="button" onclick="modify_caption(this.id)">
                                <p class="caption-control-text">Hide Caption</p>
                                <span class="carousel-control-prev-icon hide-caption-icon" aria-hidden="true"></span>
                            </button>
                            <p class="desc">Like Venn diagrams, Euler diagrams are a method for visualizing the overlap in groups. Euler diagrams have the added property that the areas of the overlaps are proportional to the amount shared between the respective groups.</p>
                        </div>
                    </div>
                    <div id="slide2" class="carousel-item full">
                        <div class="figure">
                            <svg viewBox="0 0 138.17 237.31">
                                <text class="text" transform="translate(14.27 113.75)">
                                    20 + 50 + 500 = 570 total
                                </text>
                                <circle class="circle" cx="43.37" cy="44.76" r="15.61"/>
                                <circle class="circle" cx="80.92" cy="44.76" r="43.76"/>
                                <text class="label" transform="translate(13.22 25.52)">20</text>
                                <text class="label" transform="translate(76.22 48.34)">500</text>
                                <text class="label" transform="translate(41.28 48.34)">50</text>
                                <line class="line" x1="25.23" y1="27.79" x2="30.49" y2="33.34"/>
                                <circle class="circle" cx="49.79" cy="192.54" r="15.61"/>
                                <circle class="circle" cx="87.33" cy="192.54" r="43.76"/>
                                <text class="label" transform="translate(0 156.4)">
                                    20/570 =<tspan x="10.15" y="14.4">3.5%</tspan>
                                </text>
                                <text class="label" transform="translate(82.63 196.12)">87.7%</text>
                                <text class="label" transform="translate(25.23 232.75)">8.8%</text>
                                <line class="line" x1="31.64" y1="175.56" x2="36.9" y2="181.11"/>
                                <line class="line" x1="49.19" y1="198.4" x2="41.79" y2="220.94"/>
                            </svg>
                        </div>
                        <div class="carousel-caption">
                            <button id="slide2_hide" class="carousel-control-hide-caption" type="button" onclick="modify_caption(this.id)">
                                <p class="caption-control-text" style="display: none;">Hide Caption</p>
                                <span class="carousel-control-prev-icon hide-caption-icon" aria-hidden="true"></span>
                            </button>
                            <p class="desc">The area percentage of each region is equal to the size of that area divided by the total area of the diagram.</p>
                        </div>
                    </div>
                    <div id="slide3" class="carousel-item full">
                        <div class="figure">
                            <div class="input-dashboard">
                                <div class="region_input">
                                    <label for="slide3_region1">Region 1</label>
                                    <div>
                                        <input class="region_percent" type="number" id="slide3_region1" name="slide3_region1" min="0" max="100" value="0" onChange="answer_change(this.id)">
                                        %
                                    </div>
                                    <p class="answer">40%</p>
                                </div>
                                <div class="region_input">
                                    <label for="slide3_region2">Region 2</label>
                                    <div>
                                        <input class="region_percent" type="number" id="slide3_region2" name="slide3_region2" min="0" max="100" value="0" onChange="answer_change(this.id)">
                                        %
                                    </div>
                                    <p class="answer">20%</p>
                                </div>
                                <div class="region_input">
                                    <label>Region 3</label>
                                    <p class="region3">100%</p>
                                    <p class="answer">40%</p>
                                </div>
                                <button id="slide3_check" type="button" onclick="check_answers(this.id)">Check Answers</button>
                            </div>
                            <svg viewbox="0 0 100 100">
                                <text x="50" y="25" text-anchor="middle">1</text>
                                <text x="50" y="55" text-anchor="middle">2</text>
                                <text x="50" y="85" text-anchor="middle">3</text>
                                <ellipse cx="50" cy="32.9" rx="30.9" ry="30.9" fill="transparent" stroke="black" stroke-width="1px" />
                                <ellipse cx="50" cy="67.1" rx="30.9" ry="30.9" fill="transparent" stroke="black" stroke-width="1px"/>
                            </svg>
                        </div>
                        <div class="carousel-caption">
                            <button id="slide3_hide" class="carousel-control-hide-caption" type="button" onclick="modify_caption(this.id)">
                                <p class="caption-control-text" style="display: none;">Hide Caption</p>
                                <span class="carousel-control-prev-icon hide-caption-icon" aria-hidden="true"></span>
                            </button>
                            <p class="desc">Here's some practice reading Euler diagrams. Fill in your estimates for the area percentage of each region in the above Euler diagram. Once you are done, click CHECK ANSWERS.</p>
                        </div>
                    </div>
                    <div id="slide4" class="carousel-item full">
                        <div class="figure">
                            <div class="input-dashboard">
                                <div class="region_input">
                                    <label for="slide4_region1">Region 1</label>
                                    <div>
                                        <input class="region_percent" type="number" id="slide4_region1" name="slide4_region1" min="0" max="100" value="0" onChange="answer_change(this.id)">
                                        %
                                    </div>
                                    <p class="answer">15.4%</p>
                                </div>
                                <div class="region_input">
                                    <label for="slide4_region2">Region 2</label>
                                    <div>
                                        <input class="region_percent" type="number" id="slide4_region2" name="slide4_region2" min="0" max="100" value="0" onChange="answer_change(this.id)">
                                        %
                                    </div>
                                    <p class="answer">7.7%</p>
                                </div>
                                <div class="region_input">
                                    <label>Region 3</label>
                                    <p class="region3">100%</p>
                                    <p class="answer">76.9%</p>
                                </div>
                                <button id="slide4_check" type="button" onclick="check_answers(this.id)">Check Answers</button>
                            </div>
                            <svg viewbox="0 0 200 200">
                                <text x="100" y="65" text-anchor="middle">1</text>
                                <text x="100" y="92" text-anchor="middle">2</text>
                                <text x="100" y="140" text-anchor="middle">3</text>
                                <ellipse cx="100" cy="68" rx="30.9" ry="30.9" fill="transparent" stroke="black" stroke-width="2px" />
                                <ellipse cx="100" cy="132.9" rx="59.2" ry="59.2" fill="transparent" stroke="black" stroke-width="2px"/>
                            </svg>
                        </div>
                        <div class="carousel-caption">
                            <button id="slide4_hide" class="carousel-control-hide-caption" type="button" onclick="modify_caption(this.id)">
                                <p class="caption-control-text" style="display: none;">Hide Caption</p>
                                <span class="carousel-control-prev-icon hide-caption-icon" aria-hidden="true"></span>
                            </button>
                            <p class="desc">Here's some practice reading Euler diagrams. Fill in your estimates for the area percentage of each region in the above Euler diagram. Once you are done, click CHECK ANSWERS. Your answers will be locked.</p>
                        </div>
                    </div>
                    <div id="slide5" class="carousel-item full">
                        <div id="slide5_figure" class="figure">
                            <input type="hidden" id="slide5_overlap" name="slide5_overlap">
                            <script>                                
                                var data = [
                                    {"abbreviation":"","h":0,"k":Math.random()*(1750+1750)-1750,"a":1500,"b":1500,"phi":0,"color":"#000000","stroke_dasharray":"none"},
                                    {"abbreviation":"","h":0,"k":Math.random()*(1750+1750)-1750,"a":1500,"b":1500,"phi":0,"color":"#000000","stroke_dasharray":"none"}
                                ];

                                create_interactive_euler_diagram(
                                    id="slide5_activity",
                                    where="slide5_figure",
                                    data=data,
                                    dim=450,
                                    downscale=15,
                                    bottom_y=1750,
                                    top_y=-1750,
                                    overlap_output="slide5_overlap"
                                );
                            </script>

                            <button id="slide5_check" type="button" onclick="check_answers(this.id)">Check Answer</button>
                        </div>
                        <div class="carousel-caption">
                            <button id="slide5_hide" class="carousel-control-hide-caption" type="button" onclick="modify_caption(this.id)">
                                <p class="caption-control-text" style="display: none;">Hide Caption</p>
                                <span class="carousel-control-prev-icon hide-caption-icon" aria-hidden="true"></span>
                            </button>
                            <p class="desc">If the blue and green circles each represent a group of 75 students and you know that there are students that are shared between the groups, drag these circles so that they overlap accordingly, then click SUBMIT.</p>
                        </div>
                    </div>
                    <div id="slide6" class="carousel-item full">
                        <div id="slide6_figure" class="figure">
                            <input type="hidden" id="slide6_overlap" name="slide6_overlap">
                            <script>                                
                                var data = [
                                    {"abbreviation":"","h":0,"k":Math.random()*(1750+1750)-1750,"a":1500,"b":1500,"phi":0,"color":"#000000","stroke_dasharray":"none"},
                                    {"abbreviation":"","h":0,"k":Math.random()*(1750+1750)-1750,"a":1000,"b":1000,"phi":0,"color":"#000000","stroke_dasharray":"none"}
                                ];

                                create_interactive_euler_diagram(
                                    id="slide6_activity",
                                    where="slide6_figure",
                                    data=data,
                                    dim=450,
                                    downscale=15,
                                    bottom_y=1750,
                                    top_y=-1750,
                                    overlap_output="slide6_overlap"
                                );
                            </script>
                            <p class="answer"></p>
                            <button id="slide6_check" type="button" onclick="check_answers(this.id)">Check Answer</button>
                        </div>
                        <div class="carousel-caption">
                            <button id="slide6_hide" class="carousel-control-hide-caption" type="button" onclick="modify_caption(this.id)">
                                <p class="caption-control-text" style="display: none;">Hide Caption</p>
                                <span class="carousel-control-prev-icon hide-caption-icon" aria-hidden="true"></span>
                            </button>
                            <p class="desc">One last practice! The blue circle now represents 100 students and the green circle 25 students. You also know that there are 10 students shared between the groups. Drag these circles so that they overlap accordingly, then click SUBMIT.
                            </p>
                        </div>
                    </div>
                    <div id="slide7" class="carousel-item full">
                        <div class="figure"></div>
                        <div class="carousel-caption">
                            <button id="slide7_hide" class="carousel-control-hide-caption" type="button" onclick="modify_caption(this.id)">
                                <p class="caption-control-text" style="display: none;">Hide Caption</p>
                                <span class="carousel-control-prev-icon hide-caption-icon" aria-hidden="true"></span>
                            </button>
                            <p class="desc">Now that you are acquainted with Euler diagrams, you are going to apply these diagrams to a dataset of human genetic diversity.</p>
                        </div>
                    </div>
                    <div id="slide10" class="carousel-item full">
                        <div class="figure">
                            <button type="submit">SUBMIT</button>
                        </div>
                        <div class="carousel-caption">
                            <button id="slide10_hide" class="carousel-control-hide-caption" type="button" onclick="modify_caption(this.id)">
                                <p class="caption-control-text" style="display: none;">Hide Caption</p>
                                <span class="carousel-control-prev-icon hide-caption-icon" aria-hidden="true"></span>
                            </button>
                            <p class="desc">Click SUBMIT to complete this activity!</p>
                        </div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </form>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
        <script>
            function modify_caption(id) {
                var s = id.split("_")[0];
                var slide = document.getElementById(s);
                if (slide.getElementsByClassName("caption-control-text")[0].innerText == "Hide Caption") {
                    slide.getElementsByClassName("caption-control-text")[0].innerText = "Show Caption";
                    slide.getElementsByClassName("hide-caption-icon")[0].style.transform = "rotate(90deg)"
                    slide.getElementsByClassName("desc")[0].style.display = "none";
                } else {
                    slide.getElementsByClassName("caption-control-text")[0].innerText = "Hide Caption";
                    slide.getElementsByClassName("hide-caption-icon")[0].style.transform = "rotate(-90deg)"
                    slide.getElementsByClassName("desc")[0].style.display = "block";
                }
            }

            function answer_change(id) {
                var s = id.split("_")[0];
                document.getElementById(s).getElementsByClassName("region3")[0].innerHTML = String(100 - document.getElementById(s+"_region1").value - document.getElementById(s+"_region2").value) + "%";
            }

            function check_answers(id) {
                var s = id.split("_")[0];
                var inputs = document.getElementById(s).getElementsByClassName("region_percent");
                for (let i = 0; i < inputs.length; i++) {
                    inputs[i].readOnly = true;
                }
                var answers = document.getElementById(s).getElementsByClassName("answer");
                for (let i = 0; i < answers.length; i++) {
                    answers[i].style.opacity = 1;
                }
            }

            function copy_to_clipboard(value) {
                navigator.clipboard.writeText(value);
            }

            const scriptURL = "https://script.google.com/macros/s/AKfycbyK5W2y9UQDdoBpOThyY77QSZzjb3ZJvo8CQ6pvRD0yzxsnAihPKMrjmweA_bkxe0YP/exec"
            const form = document.forms['submit-to-google-sheet']
        
            form.addEventListener("submit", e => {
                e.preventDefault();

                function randomString(length, chars) {
                    var result = '';
                    for (var i = length; i > 0; --i) result += chars[Math.floor(Math.random() * chars.length)];
                    return result;
                }

                d3.select("form").append("input")
                    .attr("type", "hidden")
                    .attr("id", "codename")
                    .attr("name", "codename")
                    .attr("value", randomString(6, '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'))
                
                var overlay = d3.select("body").append("div").attr("id", "overlay");

                //https://blog.hubspot.com/website/css-loading-animation
                var loader = overlay.append("div").attr("id", "box");
                loader.append("div").attr("class", "loader");
                loader.append("h1").text("Submitting...");
                
                fetch(scriptURL, { method: 'POST', body: new FormData(form)})
                    .then(response => {
                        var codename = document.getElementById("codename").value;
                        document.getElementById("form").remove();
                        document.getElementById("box").remove();
                        var complete = overlay.append("div").attr("id", "complete");
                        complete.append("p").text("Thank you for completing this activity. For student's seeking extra credit, please copy the following unique codeword and submit it via the corresponding assignment on Canvas.");
                        complete.append("button").attr("id", "codename_display").attr("value", codename).attr("onclick", "copy_to_clipboard(this.value)").text(codename);
                        complete.append("p").text("Click the codeword to copy it to your clipboard.")
                        complete.append("p").text("For any questions about the content of this activity, please reach out to James Kitchens at XXXXXX@XXXXXX.XXXXXXX.")
                    })
                    .catch(error => console.error('Error!', error.message))
            });
        </script>
    </body>
</html>